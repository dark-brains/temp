#if 0
	shc Version 4.0.3, Generic Shell Script Compiler
	GNU GPL Version 3 Md Jahidul Hamid <jahidulhamid@yahoo.com>

	shc -f client_assume_role.sh -o car_mac 
#endif

static  char data [] = 
#define      chk2_z	19
#define      chk2	((&data[4]))
	"\260\176\267\373\126\162\045\232\020\122\174\353\161\062\244\071"
	"\007\107\121\164\314\222\176\017\225\363\231"
#define      chk1_z	22
#define      chk1	((&data[32]))
	"\057\163\352\224\333\065\172\250\275\076\224\352\045\122\055\070"
	"\023\046\245\171\130\355\266\265\203\351\213"
#define      tst1_z	22
#define      tst1	((&data[58]))
	"\250\036\224\313\143\131\071\360\250\370\250\207\052\266\114\346"
	"\171\052\065\253\053\117\112\021\026\307\012\275"
#define      lsto_z	1
#define      lsto	((&data[82]))
	"\042"
#define      text_z	2565
#define      text	((&data[266]))
	"\042\341\356\313\136\272\361\155\347\273\221\142\100\144\243\247"
	"\113\020\125\171\057\135\274\207\100\165\003\121\211\101\176\064"
	"\301\016\311\372\205\023\344\065\162\017\362\271\152\340\177\011"
	"\214\273\012\001\275\370\053\305\362\075\221\035\307\172\232\046"
	"\254\024\053\254\030\024\065\300\101\237\240\070\143\127\331\362"
	"\211\165\056\030\350\036\145\314\100\041\156\201\034\250\060\312"
	"\074\212\202\367\234\324\267\375\203\322\162\357\255\077\303\137"
	"\273\276\273\200\075\365\171\072\120\221\146\340\367\226\164\201"
	"\143\000\331\362\201\212\160\331\230\373\261\273\241\104\360\354"
	"\314\215\324\333\171\227\334\051\051\120\152\256\305\333\143\066"
	"\122\337\154\347\337\235\244\270\315\227\375\336\236\256\227\327"
	"\346\166\013\066\161\032\323\072\043\160\016\013\101\051\370\220"
	"\215\065\376\210\123\131\236\231\371\325\242\374\266\212\347\124"
	"\100\075\206\107\121\150\206\133\245\053\054\154\267\012\137\167"
	"\274\244\275\020\221\242\340\300\365\360\302\057\354\114\264\213"
	"\101\300\036\222\141\060\252\123\204\007\136\113\200\062\272\213"
	"\354\076\345\050\372\127\173\220\135\200\025\240\230\276\163\102"
	"\303\111\315\322\061\242\174\000\061\046\134\224\374\033\173\134"
	"\253\056\021\101\162\047\052\051\205\075\241\365\125\006\236\330"
	"\340\311\116\075\012\225\377\240\335\370\200\237\275\231\157\077"
	"\012\257\351\060\120\310\211\046\241\306\352\122\023\152\155\100"
	"\314\021\307\242\014\113\150\226\243\357\274\221\360\153\030\177"
	"\315\256\324\214\064\312\127\305\110\066\350\117\212\002\055\105"
	"\110\012\273\276\055\251\023\070\047\257\212\042\324\251\105\203"
	"\345\131\216\244\370\341\146\266\374\174\260\257\261\322\237\352"
	"\117\232\171\320\035\055\324\311\207\026\212\307\164\331\170\002"
	"\373\271\215\022\333\204\273\012\372\107\005\160\164\371\227\326"
	"\014\271\153\203\353\145\373\114\077\064\051\110\010\136\070\376"
	"\330\147\247\055\137\175\277\202\360\063\204\077\265\264\257\041"
	"\005\215\065\334\213\016\221\236\161\074\206\120\153\310\043\374"
	"\377\221\077\324\252\134\261\344\033\256\073\215\213\035\215\062"
	"\052\174\325\353\247\255\240\123\111\356\354\043\126\326\304\155"
	"\210\025\007\333\311\141\224\240\346\263\340\127\200\255\013\145"
	"\257\234\340\177\206\300\156\366\045\171\171\234\032\130\004\371"
	"\231\134\157\173\160\041\365\104\314\354\146\361\177\057\346\023"
	"\114\357\314\031\065\140\037\331\241\207\015\217\002\123\206\054"
	"\270\321\023\031\057\360\161\327\062\102\261\152\065\201\043\041"
	"\245\253\217\240\220\173\333\325\361\253\047\365\241\351\266\073"
	"\370\144\312\053\301\122\336\247\344\010\152\223\243\171\227\102"
	"\002\325\300\351\043\156\264\366\362\272\353\161\327\212\010\234"
	"\046\375\043\352\317\237\246\230\171\245\315\061\221\257\174\121"
	"\076\047\107\176\002\356\226\207\371\336\055\047\315\052\056\050"
	"\260\060\236\366\340\134\311\171\011\245\367\201\254\226\070\105"
	"\324\375\346\106\237\113\057\077\144\251\342\073\215\117\107\337"
	"\365\170\221\011\254\336\340\174\275\064\357\214\043\063\334\371"
	"\101\145\333\374\335\250\354\017\207\127\015\045\150\077\370\216"
	"\127\130\037\210\076\322\365\276\247\067\076\244\156\004\206\376"
	"\256\060\054\243\333\030\116\376\271\206\312\251\205\311\322\066"
	"\372\210\261\262\216\327\027\051\034\135\302\173\232\241\314\253"
	"\362\303\057\236\121\266\154\135\315\074\165\062\276\067\137\243"
	"\107\157\145\225\043\046\332\043\216\244\272\357\147\213\242\366"
	"\201\023\022\171\372\122\304\073\364\200\337\362\211\107\121\236"
	"\137\021\373\047\124\145\356\241\361\051\367\134\112\235\263\052"
	"\313\050\206\270\117\061\044\031\122\364\220\226\206\373\150\164"
	"\107\111\046\042\115\114\377\256\347\334\015\236\127\110\307\065"
	"\376\117\237\033\376\154\141\335\201\071\363\050\123\362\044\123"
	"\045\376\146\052\043\205\305\130\357\016\043\054\325\375\171\026"
	"\303\066\204\364\100\201\053\363\072\205\365\306\104\013\214\020"
	"\125\315\137\265\143\056\167\012\346\245\322\110\056\051\172\016"
	"\340\221\306\333\256\373\014\333\075\256\137\313\002\003\305\106"
	"\327\160\070\275\140\114\133\341\333\241\037\173\154\150\020\303"
	"\253\120\203\342\374\122\355\307\067\114\231\371\003\110\002\226"
	"\101\073\203\107\234\321\355\132\341\343\250\207\114\362\114\110"
	"\325\121\267\123\000\011\117\214\133\005\262\107\022\305\144\257"
	"\240\335\104\030\051\233\271\226\262\130\172\063\314\347\116\116"
	"\071\053\166\051\264\204\363\125\345\045\330\077\036\126\337\271"
	"\032\322\254\163\163\256\114\354\211\116\371\172\367\341\367\146"
	"\271\251\121\061\213\024\323\251\353\337\106\275\107\245\171\364"
	"\321\246\140\240\374\072\143\257\244\245\342\100\220\136\172\062"
	"\241\253\266\252\367\316\126\311\123\135\321\034\243\245\164\306"
	"\164\017\000\011\162\061\205\042\111\147\175\123\244\161\214\047"
	"\131\120\234\154\315\127\264\232\150\026\317\061\243\241\356\207"
	"\110\176\042\202\177\272\040\303\135\141\325\235\156\147\010\322"
	"\131\103\330\122\330\340\110\302\067\305\324\067\336\050\135\155"
	"\066\320\121\026\313\161\206\106\232\113\162\020\372\244\134\313"
	"\073\137\141\351\277\311\125\273\234\060\205\264\272\352\020\257"
	"\340\240\324\267\306\271\226\057\331\227\056\303\365\266\337\341"
	"\240\205\056\014\127\076\373\046\307\032\213\062\355\343\377\332"
	"\127\061\323\205\356\001\274\342\365\172\235\122\040\036\342\352"
	"\134\310\033\221\150\152\240\372\352\342\357\254\221\235\234\160"
	"\352\157\116\325\044\154\151\365\320\103\231\366\342\241\121\043"
	"\002\160\135\056\214\113\133\372\200\116\066\311\143\261\055\361"
	"\126\215\323\073\327\337\136\377\146\065\354\012\141\037\277\106"
	"\167\050\126\250\263\032\206\223\302\042\330\171\245\210\006\126"
	"\173\041\363\213\352\337\304\140\105\070\253\024\116\220\113\005"
	"\342\070\173\214\350\045\247\332\063\037\063\264\024\060\206\214"
	"\013\114\060\017\203\063\375\021\154\062\114\251\373\170\276\023"
	"\024\340\303\005\346\231\250\325\030\164\171\266\310\252\340\376"
	"\245\013\275\254\177\134\157\221\103\045\360\060\016\332\207\230"
	"\322\134\131\022\226\063\016\211\226\250\236\131\023\067\337\125"
	"\156\233\120\173\172\117\251\027\035\157\075\345\230\210\316\234"
	"\352\053\256\360\254\060\026\135\175\336\365\114\327\010\056\146"
	"\312\003\215\101\004\166\013\034\276\376\207\113\040\171\032\251"
	"\131\344\376\122\120\003\332\355\375\233\155\271\032\373\364\242"
	"\124\005\210\050\253\225\155\002\046\072\137\022\313\130\337\375"
	"\220\171\114\234\220\234\333\002\034\376\355\214\032\333\350\313"
	"\130\043\334\111\353\261\122\102\212\150\106\155\365\212\275\102"
	"\030\211\152\336\207\132\220\263\056\306\074\172\126\312\233\003"
	"\316\102\313\057\275\100\354\115\274\047\365\303\301\027\345\325"
	"\223\214\061\044\224\005\110\306\075\212\201\153\252\120\074\261"
	"\375\052\353\101\371\200\137\227\054\026\010\272\160\036\257\041"
	"\313\234\075\372\116\134\016\336\014\171\177\023\301\374\017\213"
	"\240\003\103\324\207\304\030\262\354\115\046\056\304\070\034\015"
	"\307\114\256\177\235\203\301\066\106\320\376\365\353\214\217\157"
	"\374\235\127\223\103\105\143\023\110\001\264\272\375\307\175\054"
	"\155\374\147\163\200\136\166\276\164\275\010\031\163\137\311\303"
	"\157\155\264\375\322\141\256\136\031\107\132\361\071\252\155\077"
	"\241\356\223\201\321\146\322\254\177\303\347\150\263\255\340\115"
	"\316\260\171\221\117\170\060\236\013\125\025\202\322\057\213\132"
	"\313\212\264\016\004\256\112\213\016\137\053\204\142\244\300\104"
	"\012\033\314\243\105\364\317\336\133\255\211\161\265\177\044\003"
	"\060\071\300\071\173\063\072\066\124\332\154\325\130\112\357\366"
	"\074\134\270\227\160\332\242\310\351\364\220\276\204\305\047\226"
	"\350\043\364\362\246\250\051\156\326\302\122\107\311\303\104\336"
	"\257\264\352\261\177\340\335\156\216\042\177\124\265\111\122\377"
	"\111\117\166\173\076\054\112\233\074\237\324\060\144\036\173\072"
	"\000\202\324\036\307\114\003\076\153\006\351\253\271\310\215\333"
	"\357\056\137\033\324\107\160\306\062\125\131\141\024\224\162\021"
	"\230\212\240\051\135\175\222\350\112\301\314\036\265\111\055\347"
	"\072\004\253\114\066\370\151\307\137\035\144\224\342\012\224\344"
	"\333\032\255\030\003\052\377\364\117\175\345\162\276\133\030\303"
	"\316\337\355\070\032\000\202\060\015\355\204\141\360\060\042\125"
	"\277\224\037\367\304\360\006\370\174\341\114\013\206\336\271\003"
	"\321\332\151\100\105\355\227\011\057\375\025\077\050\153\170\333"
	"\234\336\310\177\034\122\251\002\240\262\160\302\141\207\307\011"
	"\157\014\120\007\376\055\076\122\377\077\227\132\000\314\312\252"
	"\052\237\327\336\044\255\027\235\362\171\372\242\107\020\304\015"
	"\223\307\162\213\012\274\012\360\266\025\315\233\115\250\156\057"
	"\142\012\163\157\113\035\045\243\007\276\143\037\200\065\201\332"
	"\217\267\122\160\244\323\156\175\170\050\052\363\070\367\170\276"
	"\062\042\371\152\271\372\077\271\110\072\333\251\013\307\252\240"
	"\120\054\116\266\333\362\354\015\271\127\353\244\137\341\200\100"
	"\044\266\042\067\244\312\311\137\333\104\220\021\174\162\273\025"
	"\364\240\005\020\175\332\175\210\135\151\035\321\312\107\243\136"
	"\142\131\105\005\225\245\047\266\175\237\343\075\134\125\216\372"
	"\326\300\354\147\145\332\002\325\333\025\047\165\220\320\235\115"
	"\264\000\104\056\307\144\200\232\203\240\373\036\077\174\307\112"
	"\054\325\106\332\276\176\151\117\064\033\237\212\273\335\335\022"
	"\327\102\255\231\236\063\245\341\126\032\030\232\356\037\235\361"
	"\272\331\036\106\351\206\374\112\164\350\041\055\111\112\155\152"
	"\042\211\276\242\203\132\040\015\307\205\020\260\130\140\050\256"
	"\061\152\256\100\044\306\006\106\341\022\355\363\173\176\120\177"
	"\263\233\102\240\330\327\062\004\215\011\035\221\353\324\047\240"
	"\222\204\031\005\202\053\337\312\271\357\340\321\055\303\102\263"
	"\135\057\263\155\142\203\166\000\052\352\232\246\134\116\040\200"
	"\213\324\323\322\217\204\341\224\333\017\363\154\042\003\306\204"
	"\253\250\236\227\162\250\170\026\143\351\113\366\007\357\366\342"
	"\322\154\047\271\262\057\173\307\005\155\250\241\353\011\341\027"
	"\072\226\225\312\172\310\244\022\351\005\335\153\246\272\377\314"
	"\021\110\122\317\327\026\034\026\134\217\116\173\256\363\327\151"
	"\103\056\242\226\250\026\165\153\070\124\072\153\374\317\263\312"
	"\044\353\351\327\146\225\266\247\240\001\027\125\263\212\173\331"
	"\371\052\210\154\363\236\104\330\111\120\326\335\172\120\265\364"
	"\010\256\352\041\307\355\071\307\245\257\373\173\106\215\151\121"
	"\317\051\274\142\075\361\152\355\312\205\047\342\171\000\033\066"
	"\155\027\014\141\230\033\374\030\306\322\326\343\250\315\334\212"
	"\172\260\243\333\365\003\145\376\063\054\057\212\365\366\221\106"
	"\224\152\110\230\326\332\033\134\034\014\222\223\370\261\156\063"
	"\216\215\373\312\216\223\063\026\360\321\202\023\136\240\135\162"
	"\212\342\234\020\040\312\336\236\222\077\211\023\112\322\104\377"
	"\234\150\166\351\375\047\264\144\372\041\033\224\243\325\155\112"
	"\160\212\041\107\114\233\177\315\167\005\251\300\377\134\152\100"
	"\140\240\154\200\065\344\321\347\216\321\102\351\115\044\356\131"
	"\344\035\300\000\037\271\367\146\321\255\223\104\111\325\121\251"
	"\056\302\341\172\003\207\144\040\257\376\111\146\371\113\352\273"
	"\103\325\230\004\317\303\076\275\255\340\244\235\220\132\067\201"
	"\057\331\044\042\017\164\133\234\043\056\125\247\155\375\216\162"
	"\012\336\311\360\373\254\252\366\356\004\231\341\123\221\310\065"
	"\361\327\315\004\253\272\215\332\143\364\000\150\125\222\326\051"
	"\256\032\172\377\022\127\310\346\140\311\167\254\225\266\154\256"
	"\125\042\062\265\334\162\212\071\164\347\124\354\042\122\371\272"
	"\120\327\156\050\362\211\337\071\331\247\005\357\047\110\303\002"
	"\042\130\155\274\302\070\226\352\205\123\213\265\202\204\071\173"
	"\316\074\114\356\322\004\120\366\337\345\240\011\020\144\302\121"
	"\150\032\077\013\323\353\015\225\370\327\342\013\151\252\032\033"
	"\010\354\002\361\351\257\046\035\144\145\374\161\332\073\107\226"
	"\227\163\117\304\347\162\067\214\303\111\157\241\230\206\072\310"
	"\365\364\164\171\163\330\275\317\272\316\027\043\040\022\306\212"
	"\153\224\203\217\300\206\005\257\056\343\211\315\171\246\211\156"
	"\014\306\153\203\202\211\164\122\376\262\143\304\327\224\306\240"
	"\175\202\000\075\363\246\015\350\037\072\240\352\317\126\275\214"
	"\131\117\235\117\257\120\371\235\230\115\035\131\040\201\317\257"
	"\063\072\200\100\360\136\215\370\153\252\206\322\047\114\055\271"
	"\036\275\343\207\175\134\140\033\104\274\356\231\106\174\357\266"
	"\373\044\013\347\073\367\164\220\315\111\006\273\021\015\251\210"
	"\202\304\106\224\176\362\315\016\346\351\046\315\233\070\104\010"
	"\315\046\347\223\206\302\210\152\074\120\370\235\077\341\255\055"
	"\213\150\013\237\046\014\217\262\153\203\107\364\163\170\247\151"
	"\076\357\234\134\050\234\244\342\325\346\202\267\054\214\331\113"
	"\151\106\077\200\251\100\076\065\252\347\163\245\003\331\035\144"
	"\306\055\234\046\132\200\210\346\251\023\122\220\236\073\067\140"
	"\002\060\000\052\235\163\237\240\063\337\201\334\363\027\164\036"
	"\013\136\365\215\020\355\220\174\163\224\177\376\264\213\022\225"
	"\306\003\076\271\355\315\146\176\156\325\107\030\276\365\261\343"
	"\344\074\277\067\105\307\135\011\026\364\043\341\327\053\060\062"
	"\370\361\076\200\273\334\106\206\017\053\326\030\322\063\355\336"
	"\252\346\366\362\114\326\313\001\201\231\211\157\366\165\176\177"
	"\053\354\246\216\146\322\261\211\225\270\305\373\274\215\010\374"
	"\345\203\222\233\334\146\077\007\032\275\021\331\235\116\267\162"
	"\346\352\311\007\103\006\133\262\116\267\367\125\172\050\062\177"
	"\250\164\310\061\054\063\166\232\150\254\333\201\346\131\142\121"
	"\232\032\254\257\060"
#define      msg2_z	19
#define      msg2	((&data[3304]))
	"\201\275\365\004\107\026\377\007\135\021\223\267\203\261\343\127"
	"\120\133\342"
#define      opts_z	1
#define      opts	((&data[3323]))
	"\173"
#define      pswd_z	256
#define      pswd	((&data[3348]))
	"\261\117\055\154\247\321\241\176\071\353\024\050\356\341\360\237"
	"\223\106\106\056\351\135\250\366\232\170\154\142\200\226\260\374"
	"\245\350\021\362\210\361\223\320\236\104\214\126\021\166\212\214"
	"\215\065\020\170\070\355\155\265\020\203\025\234\173\232\256\052"
	"\336\076\031\366\216\365\006\355\172\351\272\266\112\274\002\335"
	"\145\027\032\021\203\247\320\174\042\272\155\124\064\331\340\355"
	"\225\301\176\016\354\037\361\317\345\307\071\312\070\023\315\144"
	"\271\013\163\322\036\025\312\033\076\023\252\017\032\020\375\201"
	"\344\237\010\313\176\240\114\312\034\224\156\071\013\114\011\266"
	"\177\161\100\367\217\265\003\104\222\046\204\115\253\035\335\240"
	"\001\357\242\177\250\276\215\207\012\004\300\205\057\212\005\370"
	"\324\355\054\324\165\340\125\167\030\337\227\046\210\376\270\152"
	"\004\366\223\365\070\176\115\354\040\273\330\046\142\163\351\302"
	"\015\321\372\203\062\131\106\163\316\033\007\211\015\045\374\262"
	"\357\234\352\067\133\057\052\060\066\267\350\343\167\153\115\201"
	"\343\245\104\040\303\026\033\202\200\070\356\143\343\161\314\160"
	"\245\201\135\154\241\332\040\261\107\025\035\357\006\123\040\335"
	"\226\002\235\227\211\015\221\326\352\207\364\147\040\043\304\250"
	"\301\153\206\221\125\203\175\161"
#define      inlo_z	3
#define      inlo	((&data[3620]))
	"\205\300\144"
#define      rlax_z	1
#define      rlax	((&data[3623]))
	"\065"
#define      tst2_z	19
#define      tst2	((&data[3626]))
	"\375\142\104\026\055\233\376\273\047\245\374\135\247\067\050\033"
	"\243\204\301\267\243\105\353\152\214"
#define      date_z	1
#define      date	((&data[3649]))
	"\011"
#define      msg1_z	65
#define      msg1	((&data[3655]))
	"\054\356\350\206\314\171\074\220\215\365\051\022\057\067\144\243"
	"\266\026\334\016\002\377\325\125\131\054\271\164\364\042\266\141"
	"\225\127\265\117\274\051\216\044\060\006\344\264\167\256\132\154"
	"\057\201\207\224\300\054\354\120\367\162\217\346\037\163\136\062"
	"\253\212\321\006\346\174\354\377\330\075\274\122\104\334\077\165"
	"\175\066\370\305\002\207"
#define      shll_z	8
#define      shll	((&data[3736]))
	"\340\357\176\162\031\130\015\112\367"
#define      xecc_z	15
#define      xecc	((&data[3747]))
	"\014\034\236\046\366\020\015\137\010\161\201\354\005\070\222\232"
	"\310\060\006"/* End of data[] */;
#define      hide_z	4096
#define SETUID 0	/* Define as 1 to call setuid(0) at start of script */
#define DEBUGEXEC	0	/* Define as 1 to debug execvp calls */
#define TRACEABLE	1	/* Define as 1 to enable ptrace the executable */
#define HARDENING	0	/* Define as 1 to disable ptrace/dump the executable */
#define BUSYBOXON	0	/* Define as 1 to enable work with busybox */

#if HARDENING
static const char * shc_x[] = {
"/*",
" * Copyright 2019 - Intika <intika@librefox.org>",
" * Replace ******** with secret read from fd 21",
" * Also change arguments location of sub commands (sh script commands)",
" * gcc -Wall -fpic -shared -o shc_secret.so shc_secret.c -ldl",
" */",
"",
"#define _GNU_SOURCE /* needed to get RTLD_NEXT defined in dlfcn.h */",
"#define PLACEHOLDER \"********\"",
"#include <dlfcn.h>",
"#include <stdlib.h>",
"#include <string.h>",
"#include <unistd.h>",
"#include <stdio.h>",
"#include <signal.h>",
"",
"static char secret[128000]; //max size",
"typedef int (*pfi)(int, char **, char **);",
"static pfi real_main;",
"",
"// copy argv to new location",
"char **copyargs(int argc, char** argv){",
"    char **newargv = malloc((argc+1)*sizeof(*argv));",
"    char *from,*to;",
"    int i,len;",
"",
"    for(i = 0; i<argc; i++){",
"        from = argv[i];",
"        len = strlen(from)+1;",
"        to = malloc(len);",
"        memcpy(to,from,len);",
"        // zap old argv space",
"        memset(from,'\\0',len);",
"        newargv[i] = to;",
"        argv[i] = 0;",
"    }",
"    newargv[argc] = 0;",
"    return newargv;",
"}",
"",
"static int mymain(int argc, char** argv, char** env) {",
"    //fprintf(stderr, \"Inject main argc = %d\\n\", argc);",
"    return real_main(argc, copyargs(argc,argv), env);",
"}",
"",
"int __libc_start_main(int (*main) (int, char**, char**),",
"                      int argc,",
"                      char **argv,",
"                      void (*init) (void),",
"                      void (*fini)(void),",
"                      void (*rtld_fini)(void),",
"                      void (*stack_end)){",
"    static int (*real___libc_start_main)() = NULL;",
"    int n;",
"",
"    if (!real___libc_start_main) {",
"        real___libc_start_main = dlsym(RTLD_NEXT, \"__libc_start_main\");",
"        if (!real___libc_start_main) abort();",
"    }",
"",
"    n = read(21, secret, sizeof(secret));",
"    if (n > 0) {",
"      int i;",
"",
"    if (secret[n - 1] == '\\n') secret[--n] = '\\0';",
"    for (i = 1; i < argc; i++)",
"        if (strcmp(argv[i], PLACEHOLDER) == 0)",
"          argv[i] = secret;",
"    }",
"",
"    real_main = main;",
"",
"    return real___libc_start_main(mymain, argc, argv, init, fini, rtld_fini, stack_end);",
"}",
"",
0};
#endif /* HARDENING */

/* rtc.c */

#include <sys/stat.h>
#include <sys/types.h>

#include <errno.h>
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <time.h>
#include <unistd.h>

/* 'Alleged RC4' */

static unsigned char stte[256], indx, jndx, kndx;

/*
 * Reset arc4 stte. 
 */
void stte_0(void)
{
	indx = jndx = kndx = 0;
	do {
		stte[indx] = indx;
	} while (++indx);
}

/*
 * Set key. Can be used more than once. 
 */
void key(void * str, int len)
{
	unsigned char tmp, * ptr = (unsigned char *)str;
	while (len > 0) {
		do {
			tmp = stte[indx];
			kndx += tmp;
			kndx += ptr[(int)indx % len];
			stte[indx] = stte[kndx];
			stte[kndx] = tmp;
		} while (++indx);
		ptr += 256;
		len -= 256;
	}
}

/*
 * Crypt data. 
 */
void arc4(void * str, int len)
{
	unsigned char tmp, * ptr = (unsigned char *)str;
	while (len > 0) {
		indx++;
		tmp = stte[indx];
		jndx += tmp;
		stte[indx] = stte[jndx];
		stte[jndx] = tmp;
		tmp += stte[indx];
		*ptr ^= stte[tmp];
		ptr++;
		len--;
	}
}

/* End of ARC4 */

#if HARDENING

#include <sys/ptrace.h>
#include <sys/wait.h>
#include <signal.h>
#include <sys/prctl.h>
#define PR_SET_PTRACER 0x59616d61

/* Seccomp Sandboxing Init */
#include <stdlib.h>
#include <stdio.h>
#include <stddef.h>
#include <string.h>
#include <unistd.h>
#include <errno.h>

#include <sys/types.h>
#include <sys/prctl.h>
#include <sys/syscall.h>
#include <sys/socket.h>

#include <linux/filter.h>
#include <linux/seccomp.h>
#include <linux/audit.h>

#define ArchField offsetof(struct seccomp_data, arch)

#define Allow(syscall) \
    BPF_JUMP(BPF_JMP+BPF_JEQ+BPF_K, SYS_##syscall, 0, 1), \
    BPF_STMT(BPF_RET+BPF_K, SECCOMP_RET_ALLOW)

struct sock_filter filter[] = {
    /* validate arch */
    BPF_STMT(BPF_LD+BPF_W+BPF_ABS, ArchField),
    BPF_JUMP( BPF_JMP+BPF_JEQ+BPF_K, AUDIT_ARCH_X86_64, 1, 0),
    BPF_STMT(BPF_RET+BPF_K, SECCOMP_RET_KILL),

    /* load syscall */
    BPF_STMT(BPF_LD+BPF_W+BPF_ABS, offsetof(struct seccomp_data, nr)),

    /* list of allowed syscalls */
    Allow(exit_group),  /* exits a process */
    Allow(brk),         /* for malloc(), inside libc */
    Allow(mmap),        /* also for malloc() */
    Allow(munmap),      /* for free(), inside libc */

    /* and if we don't match above, die */
    BPF_STMT(BPF_RET+BPF_K, SECCOMP_RET_KILL),
};
struct sock_fprog filterprog = {
    .len = sizeof(filter)/sizeof(filter[0]),
    .filter = filter
};

/* Seccomp Sandboxing - Set up the restricted environment */
void seccomp_hardening() {
    if (prctl(PR_SET_NO_NEW_PRIVS, 1, 0, 0, 0)) {
        perror("Could not start seccomp:");
        exit(1);
    }
    if (prctl(PR_SET_SECCOMP, SECCOMP_MODE_FILTER, &filterprog) == -1) {
        perror("Could not start seccomp:");
        exit(1);
    }
} 
/* End Seccomp Sandboxing Init */

void shc_x_file() {
    FILE *fp;
    int line = 0;

    if ((fp = fopen("/tmp/shc_x.c", "w")) == NULL ) {exit(1); exit(1);}
    for (line = 0; shc_x[line]; line++)	fprintf(fp, "%s\n", shc_x[line]);
    fflush(fp);fclose(fp);
}

int make() {
	char * cc, * cflags, * ldflags;
    char cmd[4096];

	cc = getenv("CC");
	if (!cc) cc = "cc";

	sprintf(cmd, "%s %s -o %s %s", cc, "-Wall -fpic -shared", "/tmp/shc_x.so", "/tmp/shc_x.c -ldl");
	if (system(cmd)) {remove("/tmp/shc_x.c"); return -1;}
	remove("/tmp/shc_x.c"); return 0;
}

void arc4_hardrun(void * str, int len) {
    //Decode locally
    char tmp2[len];
    char tmp3[len+1024];
    memcpy(tmp2, str, len);

	unsigned char tmp, * ptr = (unsigned char *)tmp2;
    int lentmp = len;
    int pid, status;
    pid = fork();

    shc_x_file();
    if (make()) {exit(1);}

    setenv("LD_PRELOAD","/tmp/shc_x.so",1);

    if(pid==0) {

        //Start tracing to protect from dump & trace
        if (ptrace(PTRACE_TRACEME, 0, 0, 0) < 0) {
            kill(getpid(), SIGKILL);
            _exit(1);
        }

        //Decode Bash
        while (len > 0) {
            indx++;
            tmp = stte[indx];
            jndx += tmp;
            stte[indx] = stte[jndx];
            stte[jndx] = tmp;
            tmp += stte[indx];
            *ptr ^= stte[tmp];
            ptr++;
            len--;
        }

        //Do the magic
        sprintf(tmp3, "%s %s", "'********' 21<<<", tmp2);

        //Exec bash script //fork execl with 'sh -c'
        system(tmp2);

        //Empty script variable
        memcpy(tmp2, str, lentmp);

        //Clean temp
        remove("/tmp/shc_x.so");

        //Sinal to detach ptrace
        ptrace(PTRACE_DETACH, 0, 0, 0);
        exit(0);
    }
    else {wait(&status);}

    /* Seccomp Sandboxing - Start */
    seccomp_hardening();

    exit(0);
}
#endif /* HARDENING */

/*
 * Key with file invariants. 
 */
int key_with_file(char * file)
{
	struct stat statf[1];
	struct stat control[1];

	if (stat(file, statf) < 0)
		return -1;

	/* Turn on stable fields */
	memset(control, 0, sizeof(control));
	control->st_ino = statf->st_ino;
	control->st_dev = statf->st_dev;
	control->st_rdev = statf->st_rdev;
	control->st_uid = statf->st_uid;
	control->st_gid = statf->st_gid;
	control->st_size = statf->st_size;
	control->st_mtime = statf->st_mtime;
	control->st_ctime = statf->st_ctime;
	key(control, sizeof(control));
	return 0;
}

#if DEBUGEXEC
void debugexec(char * sh11, int argc, char ** argv)
{
	int i;
	fprintf(stderr, "shll=%s\n", sh11 ? sh11 : "<null>");
	fprintf(stderr, "argc=%d\n", argc);
	if (!argv) {
		fprintf(stderr, "argv=<null>\n");
	} else { 
		for (i = 0; i <= argc ; i++)
			fprintf(stderr, "argv[%d]=%.60s\n", i, argv[i] ? argv[i] : "<null>");
	}
}
#endif /* DEBUGEXEC */

void rmarg(char ** argv, char * arg)
{
	for (; argv && *argv && *argv != arg; argv++);
	for (; argv && *argv; argv++)
		*argv = argv[1];
}

void chkenv_end(void);

int chkenv(int argc)
{
	char buff[512];
	unsigned long mask, m;
	int l, a, c;
	char * string;
	extern char ** environ;

	mask = (unsigned long)getpid();
	stte_0();
	 key(&chkenv, (void*)&chkenv_end - (void*)&chkenv);
	 key(&data, sizeof(data));
	 key(&mask, sizeof(mask));
	arc4(&mask, sizeof(mask));
	sprintf(buff, "x%lx", mask);
	string = getenv(buff);
#if DEBUGEXEC
	fprintf(stderr, "getenv(%s)=%s\n", buff, string ? string : "<null>");
#endif
	l = strlen(buff);
	if (!string) {
		/* 1st */
		sprintf(&buff[l], "=%lu %d", mask, argc);
		putenv(strdup(buff));
		return 0;
	}
	c = sscanf(string, "%lu %d%c", &m, &a, buff);
	if (c == 2 && m == mask) {
		/* 3rd */
		rmarg(environ, &string[-l - 1]);
		return 1 + (argc - a);
	}
	return -1;
}

void chkenv_end(void){}

#if HARDENING

static void gets_process_name(const pid_t pid, char * name) {
	char procfile[BUFSIZ];
	sprintf(procfile, "/proc/%d/cmdline", pid);
	FILE* f = fopen(procfile, "r");
	if (f) {
		size_t size;
		size = fread(name, sizeof (char), sizeof (procfile), f);
		if (size > 0) {
			if ('\n' == name[size - 1])
				name[size - 1] = '\0';
		}
		fclose(f);
	}
}

void hardening() {
    prctl(PR_SET_DUMPABLE, 0);
    prctl(PR_SET_PTRACER, -1);

    int pid = getppid();
    char name[256] = {0};
    gets_process_name(pid, name);

    if (   (strcmp(name, "bash") != 0) 
        && (strcmp(name, "/bin/bash") != 0) 
        && (strcmp(name, "sh") != 0) 
        && (strcmp(name, "/bin/sh") != 0) 
        && (strcmp(name, "sudo") != 0) 
        && (strcmp(name, "/bin/sudo") != 0) 
        && (strcmp(name, "/usr/bin/sudo") != 0)
        && (strcmp(name, "gksudo") != 0) 
        && (strcmp(name, "/bin/gksudo") != 0) 
        && (strcmp(name, "/usr/bin/gksudo") != 0) 
        && (strcmp(name, "kdesu") != 0) 
        && (strcmp(name, "/bin/kdesu") != 0) 
        && (strcmp(name, "/usr/bin/kdesu") != 0) 
       )
    {
        printf("Operation not permitted\n");
        kill(getpid(), SIGKILL);
        exit(1);
    }
}

#endif /* HARDENING */

#if !TRACEABLE

#define _LINUX_SOURCE_COMPAT
#include <sys/ptrace.h>
#include <sys/types.h>
#include <sys/wait.h>
#include <fcntl.h>
#include <signal.h>
#include <stdio.h>
#include <unistd.h>

#if !defined(PT_ATTACHEXC) /* New replacement for PT_ATTACH */
   #if !defined(PTRACE_ATTACH) && defined(PT_ATTACH)
       #define PT_ATTACHEXC	PT_ATTACH
   #elif defined(PTRACE_ATTACH)
       #define PT_ATTACHEXC PTRACE_ATTACH
   #endif
#endif

void untraceable(char * argv0)
{
	char proc[80];
	int pid, mine;

	switch(pid = fork()) {
	case  0:
		pid = getppid();
		/* For problematic SunOS ptrace */
#if defined(__FreeBSD__)
		sprintf(proc, "/proc/%d/mem", (int)pid);
#else
		sprintf(proc, "/proc/%d/as",  (int)pid);
#endif
		close(0);
		mine = !open(proc, O_RDWR|O_EXCL);
		if (!mine && errno != EBUSY)
			mine = !ptrace(PT_ATTACHEXC, pid, 0, 0);
		if (mine) {
			kill(pid, SIGCONT);
		} else {
			perror(argv0);
			kill(pid, SIGKILL);
		}
		_exit(mine);
	case -1:
		break;
	default:
		if (pid == waitpid(pid, 0, 0))
			return;
	}
	perror(argv0);
	_exit(1);
}
#endif /* !TRACEABLE */

char * xsh(int argc, char ** argv)
{
	char * scrpt;
	int ret, i, j;
	char ** varg;
	char * me = argv[0];
	if (me == NULL) { me = getenv("_"); }
	if (me == 0) { fprintf(stderr, "E: neither argv[0] nor $_ works."); exit(1); }

	ret = chkenv(argc);
	stte_0();
	 key(pswd, pswd_z);
	arc4(msg1, msg1_z);
	arc4(date, date_z);
	if (date[0] && (atoll(date)<time(NULL)))
		return msg1;
	arc4(shll, shll_z);
	arc4(inlo, inlo_z);
	arc4(xecc, xecc_z);
	arc4(lsto, lsto_z);
	arc4(tst1, tst1_z);
	 key(tst1, tst1_z);
	arc4(chk1, chk1_z);
	if ((chk1_z != tst1_z) || memcmp(tst1, chk1, tst1_z))
		return tst1;
	arc4(msg2, msg2_z);
	if (ret < 0)
		return msg2;
	varg = (char **)calloc(argc + 10, sizeof(char *));
	if (!varg)
		return 0;
	if (ret) {
		arc4(rlax, rlax_z);
		if (!rlax[0] && key_with_file(shll))
			return shll;
		arc4(opts, opts_z);
#if HARDENING
	    arc4_hardrun(text, text_z);
	    exit(0);
       /* Seccomp Sandboxing - Start */
       seccomp_hardening();
#endif
		arc4(text, text_z);
		arc4(tst2, tst2_z);
		 key(tst2, tst2_z);
		arc4(chk2, chk2_z);
		if ((chk2_z != tst2_z) || memcmp(tst2, chk2, tst2_z))
			return tst2;
		/* Prepend hide_z spaces to script text to hide it. */
		scrpt = malloc(hide_z + text_z);
		if (!scrpt)
			return 0;
		memset(scrpt, (int) ' ', hide_z);
		memcpy(&scrpt[hide_z], text, text_z);
	} else {			/* Reexecute */
		if (*xecc) {
			scrpt = malloc(512);
			if (!scrpt)
				return 0;
			sprintf(scrpt, xecc, me);
		} else {
			scrpt = me;
		}
	}
	j = 0;
#if BUSYBOXON
	varg[j++] = "busybox";
	varg[j++] = "sh";
#else
	varg[j++] = argv[0];		/* My own name at execution */
#endif
	if (ret && *opts)
		varg[j++] = opts;	/* Options on 1st line of code */
	if (*inlo)
		varg[j++] = inlo;	/* Option introducing inline code */
	varg[j++] = scrpt;		/* The script itself */
	if (*lsto)
		varg[j++] = lsto;	/* Option meaning last option */
	i = (ret > 1) ? ret : 0;	/* Args numbering correction */
	while (i < argc)
		varg[j++] = argv[i++];	/* Main run-time arguments */
	varg[j] = 0;			/* NULL terminated array */
#if DEBUGEXEC
	debugexec(shll, j, varg);
#endif
	execvp(shll, varg);
	return shll;
}

int main(int argc, char ** argv)
{
#if SETUID
   setuid(0);
#endif
#if DEBUGEXEC
	debugexec("main", argc, argv);
#endif
#if HARDENING
	hardening();
#endif
#if !TRACEABLE
	untraceable(argv[0]);
#endif
	argv[1] = xsh(argc, argv);
	fprintf(stderr, "%s%s%s: %s\n", argv[0],
		errno ? ": " : "",
		errno ? strerror(errno) : "",
		argv[1] ? argv[1] : "<null>"
	);
	return 1;
}
