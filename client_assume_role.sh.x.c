#if 0
	shc Version 4.0.3, Generic Shell Script Compiler
	GNU GPL Version 3 Md Jahidul Hamid <jahidulhamid@yahoo.com>

	shc -f client_assume_role.sh -o car_mac 
#endif

static  char data [] = 
#define      date_z	1
#define      date	((&data[0]))
	"\040"
#define      inlo_z	3
#define      inlo	((&data[1]))
	"\220\236\056"
#define      xecc_z	15
#define      xecc	((&data[4]))
	"\252\146\136\350\043\136\267\343\314\366\163\366\243\015\166\242"
#define      msg1_z	65
#define      msg1	((&data[29]))
	"\332\032\275\130\227\002\002\356\034\314\070\316\370\363\176\367"
	"\366\072\365\207\275\234\004\311\251\367\034\054\214\106\027\165"
	"\005\371\357\343\105\047\035\165\147\025\363\255\335\234\255\340"
	"\054\315\000\041\014\204\302\267\374\235\160\312\124\321\271\001"
	"\113\051\222\367\117\125\050\342\112\244\374\206\065\200\037\007"
	"\331\375\345\365\301\036\147\234\375\345"
#define      tst1_z	22
#define      tst1	((&data[114]))
	"\236\147\174\164\222\045\035\206\105\000\365\032\235\021\125\367"
	"\310\134\035\127\203\111\373\201\254\163\376\370\163"
#define      chk2_z	19
#define      chk2	((&data[141]))
	"\001\051\240\354\011\274\114\167\306\161\351\026\241\374\304\325"
	"\340\066\206\033\100\231\267"
#define      pswd_z	256
#define      pswd	((&data[184]))
	"\061\200\167\226\307\065\322\247\120\153\175\253\054\074\110\146"
	"\120\013\233\144\022\366\236\347\160\210\052\206\164\046\205\364"
	"\377\212\036\027\362\150\007\376\126\323\053\262\036\217\104\071"
	"\025\146\335\376\060\237\346\370\324\056\073\362\335\022\071\146"
	"\250\102\204\033\036\131\104\114\276\147\124\050\340\031\233\353"
	"\005\055\347\241\077\331\015\105\135\120\334\302\213\352\231\113"
	"\053\310\135\351\272\365\107\002\164\316\156\265\307\177\323\333"
	"\353\054\131\206\347\203\151\027\330\265\104\207\300\107\376\221"
	"\150\157\360\235\202\267\326\370\116\036\044\372\163\117\347\125"
	"\065\312\374\012\133\327\227\013\266\047\054\141\235\211\023\316"
	"\101\073\033\010\334\154\162\265\056\114\362\015\020\251\050\040"
	"\344\002\351\146\344\362\306\151\040\037\157\165\271\055\067\065"
	"\156\357\225\233\305\323\155\021\145\305\045\032\030\321\070\237"
	"\130\365\247\131\105\313\101\210\160\241\252\020\063\354\322\133"
	"\253\335\201\155\207\215\060\032\070\331\332\261\061\166\172\215"
	"\123\257\137\344\372\106\312\161\233\321\300\244\032\243\313\227"
	"\312\326\347\041\010\155\150\363\361\123\242\367\252\306\311\325"
	"\231\013\343\126\052\125\053\147\273\167\177\322\106\134\231\162"
	"\173\124\033\066\236\263\325\105\134\256\330\001\213\110\360\166"
	"\206\167\143\154"
#define      shll_z	8
#define      shll	((&data[472]))
	"\012\301\054\202\372\307\266\120\216\273\321\331"
#define      msg2_z	19
#define      msg2	((&data[485]))
	"\157\220\376\173\150\301\354\043\013\315\134\016\045\103\354\331"
	"\157\106\072\351\350\143\265\157\166"
#define      lsto_z	1
#define      lsto	((&data[507]))
	"\021"
#define      text_z	2565
#define      text	((&data[900]))
	"\025\037\346\027\040\171\053\336\363\064\347\002\161\222\045\100"
	"\044\321\371\271\232\360\303\045\213\147\302\366\067\157\305\372"
	"\176\302\061\025\175\120\101\017\225\314\230\263\361\076\137\113"
	"\035\142\221\374\106\250\031\303\076\057\272\023\035\134\263\012"
	"\116\351\336\377\025\336\223\005\365\037\353\373\060\300\252\212"
	"\275\236\131\100\340\011\006\265\144\156\273\255\034\263\065\151"
	"\346\146\107\015\071\332\361\274\043\232\055\152\020\075\377\031"
	"\067\347\176\353\167\127\145\327\020\256\242\064\145\152\315\267"
	"\267\071\260\244\017\233\260\043\012\120\031\360\020\212\035\160"
	"\344\302\113\156\265\223\104\345\133\166\223\213\165\317\360\240"
	"\306\045\056\060\277\215\226\301\225\061\363\346\320\122\260\271"
	"\123\151\213\362\262\272\375\375\140\071\173\200\175\167\266\133"
	"\225\351\272\133\155\012\063\131\132\304\075\322\366\371\244\236"
	"\041\214\212\261\266\117\002\273\253\346\144\203\141\016\075\325"
	"\210\327\164\021\224\117\064\322\027\271\031\070\032\373\117\336"
	"\332\143\355\376\051\076\215\034\235\063\120\312\110\022\030\001"
	"\321\111\322\137\001\247\366\024\236\034\232\167\017\206\176\313"
	"\216\101\111\174\111\237\242\251\112\223\277\161\073\352\210\376"
	"\377\364\006\327\260\355\327\060\346\223\103\307\024\364\104\240"
	"\223\121\231\231\204\075\106\124\225\363\227\273\001\003\270\313"
	"\134\221\242\361\243\064\032\330\071\270\207\066\227\120\110\013"
	"\134\215\054\012\010\323\177\363\136\101\233\202\113\107\035\104"
	"\060\002\150\352\207\317\016\302\345\135\074\131\250\064\122\234"
	"\373\347\126\242\052\033\125\061\315\134\071\365\265\030\152\001"
	"\023\135\115\353\303\241\211\274\160\144\065\171\025\163\346\142"
	"\166\306\331\306\366\304\066\126\377\103\044\266\167\047\144\012"
	"\265\101\120\076\156\251\337\345\271\037\102\172\211\337\375\243"
	"\032\157\035\365\206\336\233\160\347\226\021\056\137\063\171\246"
	"\025\360\233\030\165\254\163\375\000\170\143\027\217\271\345\163"
	"\143\141\365\207\053\114\116\371\107\231\040\112\330\041\353\036"
	"\052\147\114\151\250\066\377\260\237\355\257\231\366\312\355\365"
	"\066\275\345\167\123\310\344\226\212\227\005\032\174\255\033\333"
	"\063\273\247\105\162\265\023\103\035\013\354\343\002\224\367\221"
	"\126\025\367\022\157\130\070\052\333\202\173\251\126\352\004\357"
	"\145\351\167\002\323\002\016\163\267\312\110\145\223\216\373\355"
	"\332\047\027\220\301\176\353\032\253\207\156\055\356\117\307\310"
	"\220\126\374\240\155\271\217\005\023\130\245\151\004\333\036\206"
	"\336\272\103\034\012\040\353\365\141\104\252\333\134\345\111\164"
	"\305\061\227\261\030\301\314\074\050\350\115\072\162\165\142\343"
	"\026\212\277\022\175\073\342\325\075\321\221\005\311\305\100\261"
	"\144\270\166\162\112\054\034\113\060\316\047\231\106\307\177\334"
	"\263\367\050\055\337\331\016\065\040\177\065\156\114\374\046\265"
	"\243\230\315\054\334\177\173\040\177\133\176\033\222\240\043\066"
	"\354\217\230\315\171\344\237\147\063\177\154\312\074\372\214\037"
	"\343\301\172\210\321\326\236\065\274\005\137\040\026\342\202\032"
	"\132\011\007\311\071\117\150\073\070\327\140\117\205\126\046\240"
	"\046\211\164\101\376\303\033\237\223\016\013\157\301\164\075\167"
	"\014\042\375\111\236\034\152\021\034\054\134\150\267\176\022\241"
	"\117\062\226\226\025\073\023\027\342\170\241\304\202\060\155\050"
	"\245\234\273\334\206\235\002\040\007\124\332\352\053\110\076\125"
	"\346\360\342\252\307\141\045\024\140\352\324\030\351\252\357\313"
	"\354\033\024\176\263\073\111\333\367\371\152\035\300\217\040\326"
	"\307\153\241\374\165\201\071\023\207\223\346\131\356\156\350\313"
	"\333\242\111\157\261\077\057\011\323\317\111\246\052\300\122\106"
	"\347\071\066\253\064\015\264\270\270\253\243\201\327\161\314\123"
	"\064\156\242\360\163\065\324\315\061\232\010\251\223\333\175\101"
	"\255\336\136\351\330\377\375\254\166\354\343\077\123\136\142\013"
	"\015\365\176\173\341\240\255\252\265\321\332\332\356\172\170\071"
	"\074\252\220\015\060\312\034\305\016\373\331\315\355\042\274\127"
	"\311\251\002\042\224\126\354\336\132\152\076\171\120\030\045\173"
	"\304\336\336\243\023\023\327\313\004\255\306\343\163\106\345\353"
	"\054\366\164\120\271\242\261\123\150\207\053\000\311\244\054\175"
	"\061\072\010\230\321\325\367\370\152\215\145\114\221\021\301\020"
	"\302\264\115\364\236\106\264\024\057\050\316\057\140\062\263\221"
	"\006\067\052\160\232\021\256\046\217\052\120\210\030\370\203\362"
	"\152\140\117\161\103\260\375\022\176\206\156\203\127\342\156\102"
	"\166\140\307\300\322\025\044\255\002\245\307\051\045\304\247\277"
	"\267\347\370\041\143\011\236\252\111\026\255\242\073\176\176\273"
	"\026\272\202\154\366\354\157\247\221\220\264\212\114\364\035\314"
	"\334\077\124\364\000\032\276\175\361\242\344\327\231\342\334\060"
	"\124\042\036\176\323\012\364\130\163\246\364\150\234\364\217\067"
	"\005\065\076\127\007\235\136\252\224\225\217\337\041\034\044\171"
	"\107\157\325\374\046\204\366\354\067\373\314\311\064\332\336\104"
	"\036\114\243\231\042\257\205\341\331\121\226\356\247\141\354\244"
	"\205\324\104\171\303\333\357\330\076\210\027\105\045\276\355\116"
	"\102\033\275\261\361\031\242\355\133\354\140\265\222\023\104\011"
	"\327\040\020\373\127\206\017\027\067\035\005\314\364\043\074\160"
	"\135\316\020\301\132\047\132\077\345\231\131\316\240\003\252\156"
	"\346\361\353\150\375\002\204\061\222\022\001\173\206\361\013\061"
	"\343\001\273\344\316\215\222\164\273\223\160\115\167\245\272\052"
	"\135\046\317\107\210\321\321\034\373\343\211\234\262\011\051\255"
	"\054\320\074\275\237\010\004\066\366\052\041\072\246\112\023\020"
	"\354\143\227\324\163\324\206\257\141\241\146\264\300\130\143\144"
	"\200\272\247\205\066\037\360\052\236\113\126\150\023\126\355\067"
	"\335\043\064\004\331\115\312\354\154\371\233\255\215\144\147\073"
	"\063\236\311\203\336\153\065\052\342\325\053\077\172\000\146\346"
	"\236\343\353\141\021\064\222\140\265\041\104\264\204\164\141\247"
	"\064\334\205\074\136\023\024\056\113\373\204\260\221\265\043\245"
	"\264\341\350\373\210\153\071\151\062\030\247\030\360\376\100\074"
	"\243\115\213\005\244\276\114\112\361\035\131\035\141\144\375\304"
	"\122\205\367\272\054\361\331\042\125\357\063\356\216\263\250\314"
	"\146\224\231\075\254\176\070\047\362\300\040\165\201\112\223\055"
	"\025\056\024\151\044\321\112\240\344\324\065\130\337\353\015\335"
	"\321\276\226\261\174\201\151\052\314\315\212\363\256\337\330\351"
	"\226\150\021\234\077\365\230\160\010\267\114\076\024\330\142\107"
	"\334\154\350\370\374\001\323\007\014\231\214\114\044\062\233\064"
	"\301\241\351\040\076\246\057\235\172\312\236\364\272\333\070\265"
	"\355\036\001\225\113\163\150\141\347\310\241\320\037\204\233\172"
	"\217\035\245\153\210\275\071\323\112\033\163\361\230\032\204\366"
	"\207\264\021\354\137\201\020\016\254\115\215\013\341\231\100\066"
	"\313\015\366\137\162\121\103\135\166\271\266\361\054\243\321\156"
	"\000\160\147\114\350\362\260\357\102\154\047\022\212\133\142\142"
	"\355\305\157\377\313\143\371\337\150\023\060\341\133\014\223\314"
	"\117\272\022\271\337\272\333\202\023\272\145\004\072\036\226\121"
	"\326\241\105\375\322\337\365\156\236\152\063\300\111\051\175\331"
	"\115\240\100\353\016\231\110\105\316\054\017\042\306\056\071\305"
	"\076\144\337\372\133\121\126\213\054\320\276\230\111\320\210\143"
	"\043\161\347\141\230\151\343\311\005\252\245\056\271\370\143\154"
	"\252\054\377\262\062\024\123\175\343\355\103\164\226\336\161\165"
	"\065\011\127\340\076\245\120\206\140\165\160\002\316\201\114\164"
	"\035\162\175\356\167\012\317\040\077\157\025\010\062\162\000\004"
	"\322\113\221\076\272\346\346\040\117\326\173\223\371\045\022\202"
	"\341\240\023\071\275\250\243\034\043\154\147\276\264\346\030\061"
	"\163\162\231\306\346\370\027\237\364\317\102\331\271\003\322\223"
	"\205\130\320\213\320\132\151\110\121\147\304\365\165\153\072\317"
	"\124\034\204\270\370\175\275\112\044\153\303\377\354\312\326\077"
	"\006\350\022\373\326\203\370\164\237\323\364\166\013\354\216\126"
	"\010\262\006\016\166\234\270\025\156\332\044\065\121\327\373\241"
	"\376\107\027\143\104\227\125\000\030\065\135\156\211\164\254\375"
	"\112\041\111\237\275\320\167\317\360\133\271\302\331\220\276\110"
	"\114\301\026\163\375\134\366\066\371\321\357\102\134\263\060\025"
	"\102\022\167\137\263\376\164\026\366\047\266\124\311\020\005\136"
	"\217\032\161\042\010\244\074\150\005\070\270\200\156\337\211\171"
	"\277\054\060\136\047\333\055\142\107\302\120\235\140\261\207\303"
	"\340\137\354\000\163\170\272\064\151\017\246\353\124\266\116\266"
	"\304\150\177\135\106\321\167\120\161\114\022\147\145\144\371\363"
	"\261\065\237\223\317\272\064\321\041\152\135\234\117\374\063\377"
	"\127\330\076\320\055\062\146\100\324\133\020\146\024\244\123\142"
	"\010\310\045\300\146\321\346\006\124\157\171\140\112\224\173\324"
	"\011\320\331\305\151\340\277\275\141\271\151\004\164\215\133\212"
	"\113\021\213\147\243\166\335\214\251\046\037\071\345\115\143\336"
	"\261\045\172\040\136\212\075\007\220\167\200\304\063\223\224\153"
	"\200\257\251\007\060\045\373\121\074\155\167\122\011\227\036\346"
	"\350\061\372\373\244\372\323\170\027\252\265\357\212\317\304\143"
	"\037\231\141\211\152\264\352\270\102\115\335\336\272\040\107\300"
	"\257\234\220\131\220\310\111\226\376\032\211\063\330\337\157\116"
	"\117\251\273\167\364\303\261\213\110\321\032\033\363\115\153\051"
	"\377\136\352\061\365\140\361\332\333\016\164\315\051\175\375\116"
	"\011\204\265\331\324\054\070\152\163\166\377\347\263\217\157\270"
	"\116\266\033\113\164\372\276\002\336\247\204\131\166\103\301\070"
	"\354\254\337\077\355\300\211\270\127\206\156\044\061\037\217\314"
	"\271\274\066\241\122\121\310\203\031\010\163\205\370\033\210\212"
	"\010\354\222\364\130\035\017\102\261\134\124\162\213\324\163\155"
	"\131\072\307\062\150\316\010\235\172\100\174\042\206\335\311\264"
	"\167\250\256\133\201\265\132\106\074\161\042\130\004\200\201\324"
	"\271\201\317\033\030\036\033\214\363\346\271\157\367\360\152\301"
	"\343\323\012\040\076\162\044\303\015\045\227\011\016\014\001\253"
	"\324\147\345\264\355\376\230\063\367\340\160\362\254\047\102\057"
	"\046\130\265\223\171\373\243\033\176\222\234\347\202\271\265\302"
	"\364\275\324\071\222\257\220\071\027\134\011\156\217\037\066\255"
	"\347\100\277\265\276\327\152\310\160\045\344\037\270\116\133\010"
	"\033\276\324\172\337\252\161\164\271\052\365\102\325\076\211\050"
	"\021\051\277\144\174\220\034\070\164\341\324\062\165\377\306\144"
	"\160\222\217\324\072\132\043\243\272\076\250\163\040\225\366\272"
	"\025\215\344\235\167\271\251\014\006\102\222\040\366\203\150\360"
	"\217\336\347\054\313\021\114\244\213\201\070\160\241\261\252\237"
	"\304\120\350\350\102\357\310\225\365\267\232\002\025\031\320\066"
	"\122\112\165\151\153\124\261\151\062\262\054\017\234\107\256\110"
	"\316\376\347\052\136\052\267\170\305\121\367\156\263\040\164\341"
	"\076\312\023\204\105\330\341\005\101\136\027\115\255\202\306\041"
	"\020\046\373\233\174\033\045\373\122\065\372\320\300\361\306\270"
	"\260\376\115\005\073\131\362\263\331\063\232\010\237\105\154\201"
	"\037\331\161\315\273\146\124\037\274\367\122\214\056\135\113\304"
	"\057\321\164\313\121\217\137\374\307\244\073\247\373\220\017\150"
	"\167\001\303\344\151\155\155\247\063\123\074\051\004\356\052\007"
	"\110\245\072\145\260\323\130\076\014\365\251\072\142\170\336\261"
	"\052\323\050\235\307\377\325\046\370\307\150\136\334\344\352\112"
	"\077\255\063\033\205\002\341\302\353\021\053\325\204\353\270\125"
	"\006\036\037\075\156\151\102\010\330\040\046\324\372\264\145\037"
	"\134\344\231\036\241\072\021\060\213\046\366\017\251\022\143\164"
	"\301\216\153\263\007\372\270\122\316\302\034\222\135\021\125\333"
	"\127\242\365\371\244\144\265\232\001\114\102\351\373\003\174\201"
	"\072\123\141\324\072\221\007\301\002\201\132\022\202\354\116\272"
	"\343\214\232\122\157\257\013\215\123\155\150\242\142\226\271\242"
	"\064\334\235\045\256\152\333\320\234\311\041\064\025\130\076\105"
	"\033\121\010\217\200\023\063\364\222\065\046\012\046\247\377\236"
	"\167\016\247\261\163\336\162\335\220\302\355\114\162\116\111\002"
	"\376\342\347\265\257\364\204\275\050\060\305\034\176\245\032\375"
	"\000\233\002\050\164\030\342\070\156\106\356\214\107\351\014\056"
	"\074\336\127\315\114\200\152\347\136\056\172\312\232\211\203\225"
	"\225\107\372\144\371\024\003\020\340\135\211\214\320\257\024\305"
	"\110\344\057\272\133\263\373\232\172\147\323\266\320\262\174\214"
	"\067\212\004\021\073\345\275\366\347\263\025\077\377\272\140\266"
	"\147\263\030\073\264\174\033\214\056\240\047\373\224\312\275\053"
	"\220\167\305\307\227\156\203\163\207\035\365\204\000\200\313\232"
	"\266\357\302\067\267\022\312\211\353\027\307\002\053\001\136\235"
	"\336\133\110\060\305\302\210\342\217\355\117\336\225\353\266\336"
	"\221\034\114\016\332\117\204\343\316\106\265\133\366\342\334\342"
	"\200\066\071\313\200\361\021\155\264\035\324\014\272\176\152\066"
	"\140\332\300\355\122\315\000\031\132\124\251\103\334\127\247\000"
	"\237\317\022\126\203\031\233\124\366\170\166\005\027\102\112\170"
	"\111\206\153\275\243\137\373\240\200\326\152\003\252\336\370\340"
	"\072\237\252\056\172\337\266\076\225\275\355\222\352\267\153\047"
	"\353\146\027\151\367\270\123\125\376\324\240\011\332\355\203\203"
	"\270\142\121\037\157\070\053\222\055\051\020\021\165\367\201\234"
	"\047\165\227\005\022\074\022\234\231\334\217\004\043\245\077\142"
	"\041\145\200\077\314\310\274\165\063\023\276\104\067\037\030\065"
	"\234\033\164\144\326\115\032\075\301\347\001\016\026\253\121\072"
	"\335\225\321\070\073\263\316\125\173\164\050\304\071\277\253\244"
	"\323\060\305\202\327\357\113\155\023\076\167\075\343\061\104\331"
	"\114\073\022\051\141\167\100\035\034\365\036\075\047\025\312\201"
	"\240\230\145\332\125\124\165\307\332\355\215\157\007\323\270\226"
	"\111\213\323\077\323\344\240\202\047\000\152\270\233\046\221\074"
	"\014\206\247\110\257\106\047\335\054\167\300\025\042\322\047\342"
	"\144\263\345\226\261\300\305\036\306\266\067\100\341\277\144\241"
	"\071\237\335\175\310\006\101\216\020\275\057\147\203\301\012\275"
	"\231\311\332\265\274\257\102\205\371\211\017\074\273\127\357\321"
	"\354\237\126\155\143\200\254\003\222\113\253\074\142\171\277\234"
	"\276\041\363\237\376\120\223\055\202\313\231\001\320\132\260\174"
	"\256\105\053\110\134\101\077\330\010\321\365\276\030\024\041\245"
	"\277\277\031\274\041\310\320\142\377\311"
#define      chk1_z	22
#define      chk1	((&data[3883]))
	"\142\353\012\266\271\200\012\302\121\220\226\257\023\107\254\263"
	"\072\357\366\242\263\326\114\146\273\267\207\261"
#define      rlax_z	1
#define      rlax	((&data[3906]))
	"\230"
#define      opts_z	1
#define      opts	((&data[3907]))
	"\053"
#define      tst2_z	19
#define      tst2	((&data[3912]))
	"\003\017\146\013\056\147\010\005\331\331\264\174\070\344\260\307"
	"\273\155\177\334\244\326\271\226\305"/* End of data[] */;
#define      hide_z	4096
#define SETUID 0	/* Define as 1 to call setuid(0) at start of script */
#define DEBUGEXEC	0	/* Define as 1 to debug execvp calls */
#define TRACEABLE	1	/* Define as 1 to enable ptrace the executable */
#define HARDENING	0	/* Define as 1 to disable ptrace/dump the executable */
#define BUSYBOXON	0	/* Define as 1 to enable work with busybox */

#if HARDENING
static const char * shc_x[] = {
"/*",
" * Copyright 2019 - Intika <intika@librefox.org>",
" * Replace ******** with secret read from fd 21",
" * Also change arguments location of sub commands (sh script commands)",
" * gcc -Wall -fpic -shared -o shc_secret.so shc_secret.c -ldl",
" */",
"",
"#define _GNU_SOURCE /* needed to get RTLD_NEXT defined in dlfcn.h */",
"#define PLACEHOLDER \"********\"",
"#include <dlfcn.h>",
"#include <stdlib.h>",
"#include <string.h>",
"#include <unistd.h>",
"#include <stdio.h>",
"#include <signal.h>",
"",
"static char secret[128000]; //max size",
"typedef int (*pfi)(int, char **, char **);",
"static pfi real_main;",
"",
"// copy argv to new location",
"char **copyargs(int argc, char** argv){",
"    char **newargv = malloc((argc+1)*sizeof(*argv));",
"    char *from,*to;",
"    int i,len;",
"",
"    for(i = 0; i<argc; i++){",
"        from = argv[i];",
"        len = strlen(from)+1;",
"        to = malloc(len);",
"        memcpy(to,from,len);",
"        // zap old argv space",
"        memset(from,'\\0',len);",
"        newargv[i] = to;",
"        argv[i] = 0;",
"    }",
"    newargv[argc] = 0;",
"    return newargv;",
"}",
"",
"static int mymain(int argc, char** argv, char** env) {",
"    //fprintf(stderr, \"Inject main argc = %d\\n\", argc);",
"    return real_main(argc, copyargs(argc,argv), env);",
"}",
"",
"int __libc_start_main(int (*main) (int, char**, char**),",
"                      int argc,",
"                      char **argv,",
"                      void (*init) (void),",
"                      void (*fini)(void),",
"                      void (*rtld_fini)(void),",
"                      void (*stack_end)){",
"    static int (*real___libc_start_main)() = NULL;",
"    int n;",
"",
"    if (!real___libc_start_main) {",
"        real___libc_start_main = dlsym(RTLD_NEXT, \"__libc_start_main\");",
"        if (!real___libc_start_main) abort();",
"    }",
"",
"    n = read(21, secret, sizeof(secret));",
"    if (n > 0) {",
"      int i;",
"",
"    if (secret[n - 1] == '\\n') secret[--n] = '\\0';",
"    for (i = 1; i < argc; i++)",
"        if (strcmp(argv[i], PLACEHOLDER) == 0)",
"          argv[i] = secret;",
"    }",
"",
"    real_main = main;",
"",
"    return real___libc_start_main(mymain, argc, argv, init, fini, rtld_fini, stack_end);",
"}",
"",
0};
#endif /* HARDENING */

/* rtc.c */

#include <sys/stat.h>
#include <sys/types.h>

#include <errno.h>
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <time.h>
#include <unistd.h>

/* 'Alleged RC4' */

static unsigned char stte[256], indx, jndx, kndx;

/*
 * Reset arc4 stte. 
 */
void stte_0(void)
{
	indx = jndx = kndx = 0;
	do {
		stte[indx] = indx;
	} while (++indx);
}

/*
 * Set key. Can be used more than once. 
 */
void key(void * str, int len)
{
	unsigned char tmp, * ptr = (unsigned char *)str;
	while (len > 0) {
		do {
			tmp = stte[indx];
			kndx += tmp;
			kndx += ptr[(int)indx % len];
			stte[indx] = stte[kndx];
			stte[kndx] = tmp;
		} while (++indx);
		ptr += 256;
		len -= 256;
	}
}

/*
 * Crypt data. 
 */
void arc4(void * str, int len)
{
	unsigned char tmp, * ptr = (unsigned char *)str;
	while (len > 0) {
		indx++;
		tmp = stte[indx];
		jndx += tmp;
		stte[indx] = stte[jndx];
		stte[jndx] = tmp;
		tmp += stte[indx];
		*ptr ^= stte[tmp];
		ptr++;
		len--;
	}
}

/* End of ARC4 */

#if HARDENING

#include <sys/ptrace.h>
#include <sys/wait.h>
#include <signal.h>
#include <sys/prctl.h>
#define PR_SET_PTRACER 0x59616d61

/* Seccomp Sandboxing Init */
#include <stdlib.h>
#include <stdio.h>
#include <stddef.h>
#include <string.h>
#include <unistd.h>
#include <errno.h>

#include <sys/types.h>
#include <sys/prctl.h>
#include <sys/syscall.h>
#include <sys/socket.h>

#include <linux/filter.h>
#include <linux/seccomp.h>
#include <linux/audit.h>

#define ArchField offsetof(struct seccomp_data, arch)

#define Allow(syscall) \
    BPF_JUMP(BPF_JMP+BPF_JEQ+BPF_K, SYS_##syscall, 0, 1), \
    BPF_STMT(BPF_RET+BPF_K, SECCOMP_RET_ALLOW)

struct sock_filter filter[] = {
    /* validate arch */
    BPF_STMT(BPF_LD+BPF_W+BPF_ABS, ArchField),
    BPF_JUMP( BPF_JMP+BPF_JEQ+BPF_K, AUDIT_ARCH_X86_64, 1, 0),
    BPF_STMT(BPF_RET+BPF_K, SECCOMP_RET_KILL),

    /* load syscall */
    BPF_STMT(BPF_LD+BPF_W+BPF_ABS, offsetof(struct seccomp_data, nr)),

    /* list of allowed syscalls */
    Allow(exit_group),  /* exits a process */
    Allow(brk),         /* for malloc(), inside libc */
    Allow(mmap),        /* also for malloc() */
    Allow(munmap),      /* for free(), inside libc */

    /* and if we don't match above, die */
    BPF_STMT(BPF_RET+BPF_K, SECCOMP_RET_KILL),
};
struct sock_fprog filterprog = {
    .len = sizeof(filter)/sizeof(filter[0]),
    .filter = filter
};

/* Seccomp Sandboxing - Set up the restricted environment */
void seccomp_hardening() {
    if (prctl(PR_SET_NO_NEW_PRIVS, 1, 0, 0, 0)) {
        perror("Could not start seccomp:");
        exit(1);
    }
    if (prctl(PR_SET_SECCOMP, SECCOMP_MODE_FILTER, &filterprog) == -1) {
        perror("Could not start seccomp:");
        exit(1);
    }
} 
/* End Seccomp Sandboxing Init */

void shc_x_file() {
    FILE *fp;
    int line = 0;

    if ((fp = fopen("/tmp/shc_x.c", "w")) == NULL ) {exit(1); exit(1);}
    for (line = 0; shc_x[line]; line++)	fprintf(fp, "%s\n", shc_x[line]);
    fflush(fp);fclose(fp);
}

int make() {
	char * cc, * cflags, * ldflags;
    char cmd[4096];

	cc = getenv("CC");
	if (!cc) cc = "cc";

	sprintf(cmd, "%s %s -o %s %s", cc, "-Wall -fpic -shared", "/tmp/shc_x.so", "/tmp/shc_x.c -ldl");
	if (system(cmd)) {remove("/tmp/shc_x.c"); return -1;}
	remove("/tmp/shc_x.c"); return 0;
}

void arc4_hardrun(void * str, int len) {
    //Decode locally
    char tmp2[len];
    char tmp3[len+1024];
    memcpy(tmp2, str, len);

	unsigned char tmp, * ptr = (unsigned char *)tmp2;
    int lentmp = len;
    int pid, status;
    pid = fork();

    shc_x_file();
    if (make()) {exit(1);}

    setenv("LD_PRELOAD","/tmp/shc_x.so",1);

    if(pid==0) {

        //Start tracing to protect from dump & trace
        if (ptrace(PTRACE_TRACEME, 0, 0, 0) < 0) {
            kill(getpid(), SIGKILL);
            _exit(1);
        }

        //Decode Bash
        while (len > 0) {
            indx++;
            tmp = stte[indx];
            jndx += tmp;
            stte[indx] = stte[jndx];
            stte[jndx] = tmp;
            tmp += stte[indx];
            *ptr ^= stte[tmp];
            ptr++;
            len--;
        }

        //Do the magic
        sprintf(tmp3, "%s %s", "'********' 21<<<", tmp2);

        //Exec bash script //fork execl with 'sh -c'
        system(tmp2);

        //Empty script variable
        memcpy(tmp2, str, lentmp);

        //Clean temp
        remove("/tmp/shc_x.so");

        //Sinal to detach ptrace
        ptrace(PTRACE_DETACH, 0, 0, 0);
        exit(0);
    }
    else {wait(&status);}

    /* Seccomp Sandboxing - Start */
    seccomp_hardening();

    exit(0);
}
#endif /* HARDENING */

/*
 * Key with file invariants. 
 */
int key_with_file(char * file)
{
	struct stat statf[1];
	struct stat control[1];

	if (stat(file, statf) < 0)
		return -1;

	/* Turn on stable fields */
	memset(control, 0, sizeof(control));
	control->st_ino = statf->st_ino;
	control->st_dev = statf->st_dev;
	control->st_rdev = statf->st_rdev;
	control->st_uid = statf->st_uid;
	control->st_gid = statf->st_gid;
	control->st_size = statf->st_size;
	control->st_mtime = statf->st_mtime;
	control->st_ctime = statf->st_ctime;
	key(control, sizeof(control));
	return 0;
}

#if DEBUGEXEC
void debugexec(char * sh11, int argc, char ** argv)
{
	int i;
	fprintf(stderr, "shll=%s\n", sh11 ? sh11 : "<null>");
	fprintf(stderr, "argc=%d\n", argc);
	if (!argv) {
		fprintf(stderr, "argv=<null>\n");
	} else { 
		for (i = 0; i <= argc ; i++)
			fprintf(stderr, "argv[%d]=%.60s\n", i, argv[i] ? argv[i] : "<null>");
	}
}
#endif /* DEBUGEXEC */

void rmarg(char ** argv, char * arg)
{
	for (; argv && *argv && *argv != arg; argv++);
	for (; argv && *argv; argv++)
		*argv = argv[1];
}

void chkenv_end(void);

int chkenv(int argc)
{
	char buff[512];
	unsigned long mask, m;
	int l, a, c;
	char * string;
	extern char ** environ;

	mask = (unsigned long)getpid();
	stte_0();
	 key(&chkenv, (void*)&chkenv_end - (void*)&chkenv);
	 key(&data, sizeof(data));
	 key(&mask, sizeof(mask));
	arc4(&mask, sizeof(mask));
	sprintf(buff, "x%lx", mask);
	string = getenv(buff);
#if DEBUGEXEC
	fprintf(stderr, "getenv(%s)=%s\n", buff, string ? string : "<null>");
#endif
	l = strlen(buff);
	if (!string) {
		/* 1st */
		sprintf(&buff[l], "=%lu %d", mask, argc);
		putenv(strdup(buff));
		return 0;
	}
	c = sscanf(string, "%lu %d%c", &m, &a, buff);
	if (c == 2 && m == mask) {
		/* 3rd */
		rmarg(environ, &string[-l - 1]);
		return 1 + (argc - a);
	}
	return -1;
}

void chkenv_end(void){}

#if HARDENING

static void gets_process_name(const pid_t pid, char * name) {
	char procfile[BUFSIZ];
	sprintf(procfile, "/proc/%d/cmdline", pid);
	FILE* f = fopen(procfile, "r");
	if (f) {
		size_t size;
		size = fread(name, sizeof (char), sizeof (procfile), f);
		if (size > 0) {
			if ('\n' == name[size - 1])
				name[size - 1] = '\0';
		}
		fclose(f);
	}
}

void hardening() {
    prctl(PR_SET_DUMPABLE, 0);
    prctl(PR_SET_PTRACER, -1);

    int pid = getppid();
    char name[256] = {0};
    gets_process_name(pid, name);

    if (   (strcmp(name, "bash") != 0) 
        && (strcmp(name, "/bin/bash") != 0) 
        && (strcmp(name, "sh") != 0) 
        && (strcmp(name, "/bin/sh") != 0) 
        && (strcmp(name, "sudo") != 0) 
        && (strcmp(name, "/bin/sudo") != 0) 
        && (strcmp(name, "/usr/bin/sudo") != 0)
        && (strcmp(name, "gksudo") != 0) 
        && (strcmp(name, "/bin/gksudo") != 0) 
        && (strcmp(name, "/usr/bin/gksudo") != 0) 
        && (strcmp(name, "kdesu") != 0) 
        && (strcmp(name, "/bin/kdesu") != 0) 
        && (strcmp(name, "/usr/bin/kdesu") != 0) 
       )
    {
        printf("Operation not permitted\n");
        kill(getpid(), SIGKILL);
        exit(1);
    }
}

#endif /* HARDENING */

#if !TRACEABLE

#define _LINUX_SOURCE_COMPAT
#include <sys/ptrace.h>
#include <sys/types.h>
#include <sys/wait.h>
#include <fcntl.h>
#include <signal.h>
#include <stdio.h>
#include <unistd.h>

#if !defined(PT_ATTACHEXC) /* New replacement for PT_ATTACH */
   #if !defined(PTRACE_ATTACH) && defined(PT_ATTACH)
       #define PT_ATTACHEXC	PT_ATTACH
   #elif defined(PTRACE_ATTACH)
       #define PT_ATTACHEXC PTRACE_ATTACH
   #endif
#endif

void untraceable(char * argv0)
{
	char proc[80];
	int pid, mine;

	switch(pid = fork()) {
	case  0:
		pid = getppid();
		/* For problematic SunOS ptrace */
#if defined(__FreeBSD__)
		sprintf(proc, "/proc/%d/mem", (int)pid);
#else
		sprintf(proc, "/proc/%d/as",  (int)pid);
#endif
		close(0);
		mine = !open(proc, O_RDWR|O_EXCL);
		if (!mine && errno != EBUSY)
			mine = !ptrace(PT_ATTACHEXC, pid, 0, 0);
		if (mine) {
			kill(pid, SIGCONT);
		} else {
			perror(argv0);
			kill(pid, SIGKILL);
		}
		_exit(mine);
	case -1:
		break;
	default:
		if (pid == waitpid(pid, 0, 0))
			return;
	}
	perror(argv0);
	_exit(1);
}
#endif /* !TRACEABLE */

char * xsh(int argc, char ** argv)
{
	char * scrpt;
	int ret, i, j;
	char ** varg;
	char * me = argv[0];
	if (me == NULL) { me = getenv("_"); }
	if (me == 0) { fprintf(stderr, "E: neither argv[0] nor $_ works."); exit(1); }

	ret = chkenv(argc);
	stte_0();
	 key(pswd, pswd_z);
	arc4(msg1, msg1_z);
	arc4(date, date_z);
	if (date[0] && (atoll(date)<time(NULL)))
		return msg1;
	arc4(shll, shll_z);
	arc4(inlo, inlo_z);
	arc4(xecc, xecc_z);
	arc4(lsto, lsto_z);
	arc4(tst1, tst1_z);
	 key(tst1, tst1_z);
	arc4(chk1, chk1_z);
	if ((chk1_z != tst1_z) || memcmp(tst1, chk1, tst1_z))
		return tst1;
	arc4(msg2, msg2_z);
	if (ret < 0)
		return msg2;
	varg = (char **)calloc(argc + 10, sizeof(char *));
	if (!varg)
		return 0;
	if (ret) {
		arc4(rlax, rlax_z);
		if (!rlax[0] && key_with_file(shll))
			return shll;
		arc4(opts, opts_z);
#if HARDENING
	    arc4_hardrun(text, text_z);
	    exit(0);
       /* Seccomp Sandboxing - Start */
       seccomp_hardening();
#endif
		arc4(text, text_z);
		arc4(tst2, tst2_z);
		 key(tst2, tst2_z);
		arc4(chk2, chk2_z);
		if ((chk2_z != tst2_z) || memcmp(tst2, chk2, tst2_z))
			return tst2;
		/* Prepend hide_z spaces to script text to hide it. */
		scrpt = malloc(hide_z + text_z);
		if (!scrpt)
			return 0;
		memset(scrpt, (int) ' ', hide_z);
		memcpy(&scrpt[hide_z], text, text_z);
	} else {			/* Reexecute */
		if (*xecc) {
			scrpt = malloc(512);
			if (!scrpt)
				return 0;
			sprintf(scrpt, xecc, me);
		} else {
			scrpt = me;
		}
	}
	j = 0;
#if BUSYBOXON
	varg[j++] = "busybox";
	varg[j++] = "sh";
#else
	varg[j++] = argv[0];		/* My own name at execution */
#endif
	if (ret && *opts)
		varg[j++] = opts;	/* Options on 1st line of code */
	if (*inlo)
		varg[j++] = inlo;	/* Option introducing inline code */
	varg[j++] = scrpt;		/* The script itself */
	if (*lsto)
		varg[j++] = lsto;	/* Option meaning last option */
	i = (ret > 1) ? ret : 0;	/* Args numbering correction */
	while (i < argc)
		varg[j++] = argv[i++];	/* Main run-time arguments */
	varg[j] = 0;			/* NULL terminated array */
#if DEBUGEXEC
	debugexec(shll, j, varg);
#endif
	execvp(shll, varg);
	return shll;
}

int main(int argc, char ** argv)
{
#if SETUID
   setuid(0);
#endif
#if DEBUGEXEC
	debugexec("main", argc, argv);
#endif
#if HARDENING
	hardening();
#endif
#if !TRACEABLE
	untraceable(argv[0]);
#endif
	argv[1] = xsh(argc, argv);
	fprintf(stderr, "%s%s%s: %s\n", argv[0],
		errno ? ": " : "",
		errno ? strerror(errno) : "",
		argv[1] ? argv[1] : "<null>"
	);
	return 1;
}
